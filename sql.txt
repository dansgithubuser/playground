--each queries can have two forms of documentation, abstract and concrete
--in abstract form, values to be filled in are in <chevrons>
--in concrete form, the query is valid (except that names of tables and fields and such are just named after their type)

--postgres fast table count estimate
--from https://wiki.postgresql.org/wiki/Count_estimate
SELECT reltuples FROM pg_class WHERE relname = '<table>';
SELECT reltuples FROM pg_class WHERE relname = 'table';

--query on random sampling of table
--works best when table size is much greater than physical page size
--from https://wiki.postgresql.org/wiki/Count_estimate
SELECT <selection> FROM <table> TABLESAMPLE SYSTEM(<percentage 0.0 to 100.0>) WHERE <condition>;
SELECT COUNT(*) FROM table TABLESAMPLE SYSTEM(0.1) WHERE field LIKE 'prefix+%';

--postgres count estimate function
--from https://wiki.postgresql.org/wiki/Count_estimate
CREATE FUNCTION count_estimate(query text) RETURNS INTEGER AS
$func$
DECLARE
    rec   record;
    ROWS  INTEGER;
BEGIN
    FOR rec IN EXECUTE 'EXPLAIN ' || query LOOP
        ROWS := SUBSTRING(rec."QUERY PLAN" FROM ' rows=([[:digit:]]+)');
        EXIT WHEN ROWS IS NOT NULL;
    END LOOP;

    RETURN ROWS;
END
$func$ LANGUAGE plpgsql;

--check existance of a field in another table
SELECT <selection> FROM <table_a> WHERE EXISTS (SELECT * FROM <table_b> as b WHERE b.id=id);
SELECT COUNT(*) FROM table_a WHERE EXISTS (SELECT * FROM table_b as b WHERE b.id=id);
