#!/usr/bin/python

import os, shutil, subprocess, sys

try: input=raw_input
except: pass

this=os.path.realpath(__file__)

def timestamp(ambiguous=True):
	import datetime
	format='{:%Y-%m'
	if not ambiguous: format+='-%b'
	format+='-%d %H:%M:%S.%f}'
	return format.format(datetime.datetime.now()).lower()

def home_path(path): return os.path.join(os.path.expanduser('~'), *path.split('/'))

def invoke(invocation):
	if '--dry' in sys.argv: print(invocation)
	else: subprocess.check_call(invocation, shell=True)

def bash():
	shutil.copy(this, home_path('Desktop/scripts'))
	with open(home_path('Desktop/scripts/dan-bash.sh'), 'w') as file:
		file.write('''
			force_color_prompt=yes
			PATH=$PATH:~/Desktop/scripts
			PS1='\\e[0;37;44m               $?               \\e[m \n\\h \\t \\w$ '
			alias o="xdg-open ."
			echo "dan bash ran"
		''')

def sleep(): invoke('systemctl suspend')

def reboot(): invoke('reboot')

def off(): invoke('poweroff')

def link(link, linked):
	invoke('ln -s {} {}'.format(linked, link))

def find(name):
	invoke('find . -name {}'.format(name))

def vu(): invoke('pactl -- set-sink-volume 0 +10%')
def vd(): invoke('pactl -- set-sink-volume 0 -10%')

def brightness(level):
	path='/sys/class/backlight/intel_backlight/brightness'
	if level=='get':
		with open(path) as file:
			return int(file.read())
	invoke('echo {}|sudo tee {}'.format(int(level), path))

def b(level):
	if level=='get': return (brightness('get')-5000)/1000.0
	brightness(int(level)*1000+5000)

def bu(): b(b('get')*2)
def bd(): b(b('get')//2)

def i(command):
	with open(home_path('Desktop/dan-install.txt'), 'a') as file:
		file.write(timestamp(False)+'\n')
		file.write(command+'\n')
		file.write('\n')
	invoke(command)

def install_self():
	bash_init=None
	if os.path.exists(home_path('.bash_profile')): bash_init=home_path('.bash_profile')
	elif os.path.exists(home_path('.bashrc')): bash_init=home_path('.bashrc')
	if not bash_init:
		print("couldn't find a bash init script!")
		sys.exit(1)
	print('I will append to {} and create files in ~/Desktop/scripts -- if that is OK, enter y'.format(bash_init))
	if input()!='y': sys.exit(1)
	with open(bash_init, 'a') as file:
		file.write("\n\n#=====appended by dan from dangihubuser's playground=====#\n")
		file.write('python {} bash\n'.format(this))
		file.write('source {}\n'.format(home_path('Desktop/scripts/dan-bash.sh')))
		file.write('#=====end dan=====#\n')

try: user_command=eval(sys.argv[1])
except:
	print(sorted([i for i in dir() if not i.startswith('__')]))
	sys.exit(1)
try: exec(sys.argv[1]+'(*sys.argv[2:])')
except TypeError:
	import inspect
	print(inspect.getargspec(user_command))
